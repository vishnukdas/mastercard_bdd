---
# HyperExecute YAML version
version: "0.1"
# OS to run tests on (win, linux, mac, mac13)
runson: win

# Enable autosplit to distribute scenarios
autosplit: true
# Number of parallel tasks
concurrency: 5

# Runtime language and version
runtime:
  - language: java
    version: "17"

# Cache key to reuse dependencies between runs
cacheKey: '{{ checksum "pom.xml" }}'
# Cache Maven repository
cacheDirectories:
  - .m2

# Global pre-steps to prepare dependencies once
globalPre:
  mode: remote
  cache: true
  commands:
    - mvn -Dmaven.repo.local=./.m2 dependency:resolve

# Discover tests using Snooper (Cucumber) in automatic mode
testDiscovery:
  type: automatic
  mode: static
  args:
    featureFilePaths: src/test/resources/features
    frameWork: java
    specificTags: ["@api"]

# Run a single discovered test entity (use cached .m2)
testRunnerCommand: mvn `-Dmaven.repo.local=./.m2 test `-Dcucumber.features="$test"

# Job labels for easier filtering
jobLabel: ["api", "mastercard"]

# Retry failed tests
retryOnFailure: true
maxRetries: 1

# Use scenario command status for overall status
scenarioCommandStatusOnly: true

# Upload Cucumber JSON report
report: true
partialReports:
  location: target/cucumber-report.json
  frameworkName: cucumber
  type: json

betaFeature:
  skipQueueOverride: true
